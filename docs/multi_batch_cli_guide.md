# 다중 배치 CLI 기능 가이드

## 개요

다중 배치 CLI 기능은 여러 계정에 대해 배치 작업을 순차적으로 실행하고, 통합된 로그 관리와 요약 보고서를 제공하는 기능입니다.

## 주요 특징

### ✨ 핵심 기능
- **다중 계정 순차 실행**: 여러 계정을 지정하여 순차적으로 배치 작업 실행
- **통합 로그 관리**: 모든 배치 실행을 하나의 세션으로 관리
- **실시간 진행 상황**: 각 배치의 실행 상태를 실시간으로 확인
- **통합 요약 보고서**: 전체 배치 실행 결과를 한눈에 볼 수 있는 상세 보고서
- **유연한 설정**: 수량, 실행 간격, 단계 등을 자유롭게 설정

### 📊 개선된 로그 시스템
- **단일 로그 폴더**: 동시 실행된 배치들을 하나의 폴더에서 관리
- **통합 로그 파일**: 모든 배치 실행 과정을 하나의 파일에 기록
- **통합 요약 보고서**: 전체 실행 결과를 마크다운 형식으로 저장

## 사용법

### 기본 명령어 구조
```bash
python cli/batch_cli.py multi-batch [계정목록] [옵션]
```

### 필수 인수
- `계정목록`: 실행할 계정 ID 목록 (공백으로 구분)
  - 숫자 형식: `1 2 3`
  - 계정명 형식: `account_1 account_2 account_3`

### 선택적 옵션
- `-s, --step`: 실행할 단계 (기본값: 1)
- `-q, --quantity`: 처리할 수량 (기본값: 10)
- `-i, --interval`: 배치 간 실행 간격(초) (기본값: 5)
- `-o, --output`: 결과 저장 파일 경로

## 사용 예시

### 1. 기본 실행
```bash
# 계정 1, 2, 3을 기본 설정으로 실행
python cli/batch_cli.py multi-batch 1 2 3
```

### 2. 수량과 간격 지정
```bash
# 수량 20개, 배치 간 10초 간격으로 실행
python cli/batch_cli.py multi-batch 1 2 3 -q 20 -i 10
```

### 3. 다른 단계 실행
```bash
# 단계 2를 실행
python cli/batch_cli.py multi-batch 1 2 3 -s 2
```

### 4. 결과 파일 저장
```bash
# 결과를 JSON 파일로 저장
python cli/batch_cli.py multi-batch 1 2 3 -o results/multi_batch_result.json
```

### 5. 복합 설정
```bash
# 모든 옵션을 조합한 실행
python cli/batch_cli.py multi-batch 1 2 3 4 5 -s 1 -q 15 -i 8 -o results/custom_result.json
```

## 실행 결과

### 실시간 출력
실행 중에는 다음과 같은 정보가 실시간으로 출력됩니다:

```
=== 다중 배치 동시 실행 ===
입력 계정: ['1', '2', '3']
변환된 계정: ['account_1', 'account_2', 'account_3']
실행 단계: 1
수량: 10
실행 간격: 5초
통합 로그 세션: 20241201_143022_multi_batch

--- 배치 1/3: account_1 ---
배치 1 결과: ✅ 성공 (처리: 8개)
다음 배치까지 5초 대기...

--- 배치 2/3: account_2 ---
배치 2 결과: ✅ 성공 (처리: 10개)
다음 배치까지 5초 대기...

--- 배치 3/3: account_3 ---
배치 3 결과: ✅ 성공 (처리: 7개)
```

### 통합 요약 보고서
실행 완료 후 상세한 통합 요약 보고서가 출력됩니다:

```
============================================================
🚀 다중 배치 실행 완료 - 통합 요약 보고서
============================================================
📋 통합 세션 ID: 20241201_143022_multi_batch
⏱️  총 소요 시간: 45.32초
🎯 전체 실행 결과: ✅ 성공

--------------------------------------------------
📊 배치별 상세 결과
--------------------------------------------------

✅ 배치 1: account_1
   소요 시간: 12.45초
   처리 완료: 8개
   처리 실패: 0개
   실행 전 비그룹상품: 15개
   실행 후 비그룹상품: 7개
   실제 처리된 수량: 8개
   상태: ✅ 정상 처리 (누락 없음)

✅ 배치 2: account_2
   소요 시간: 15.23초
   처리 완료: 10개
   처리 실패: 0개
   실행 전 비그룹상품: 25개
   실행 후 비그룹상품: 15개
   실제 처리된 수량: 10개
   상태: ✅ 정상 처리 (누락 없음)

==================================================
📈 전체 통계 요약
==================================================
🏢 총 배치 수: 3개
✅ 성공한 배치: 3개
❌ 실패한 배치: 0개
📦 총 처리 완료: 25개
⚠️  총 처리 실패: 0개
🎯 성공률: 100.0%

============================================================
🎉 다중 배치 실행 완료!
============================================================

📁 통합 로그 파일: logs/unified/20241201_143022_multi_batch.log
📊 통합 요약 보고서: logs/unified/20241201_143022_multi_batch_summary.md
```

## 로그 파일 구조

다중 배치 실행 시 다음과 같은 로그 파일들이 생성됩니다:

```
logs/
├── unified/                           # 통합 로그 폴더
│   ├── 20241201_143022_multi_batch.log           # 통합 로그 파일
│   └── 20241201_143022_multi_batch_summary.md    # 통합 요약 보고서
├── accounts/                          # 계정별 상세 로그
│   └── 20241201_143022/
│       ├── account_1.log
│       ├── account_2.log
│       └── account_3.log
├── errors/                            # 오류 로그
│   └── 20241201_143022_errors.log
└── reports/                           # 개별 배치 보고서
    └── 20241201_143022/
        ├── batch_report_single_step_1_account_1.md
        ├── batch_report_single_step_1_account_2.md
        └── summary_report_20241201_143022.md
```

## 장점

### 🎯 운영 효율성
- **시각적 명확성**: 여러 배치를 동시 실행해도 하나의 통합 보고서로 결과 확인
- **빠른 판단**: CLI 실행 완료 후 즉시 통합 요약 출력으로 빠른 상황 파악
- **중앙 집중식 관리**: 모든 배치 실행을 하나의 세션으로 관리

### 🔍 디버깅 및 모니터링
- **통합 로그**: 모든 배치 실행 과정을 하나의 파일에서 추적 가능
- **상세 분석**: 계정별, 단계별 상세 로그는 별도 보관하여 심층 분석 지원
- **오류 추적**: 통합 세션 ID로 관련된 모든 로그 파일 연결

### 📊 보고 및 분석
- **통합 통계**: 전체 배치 실행에 대한 종합적인 성공률 및 처리량 분석
- **비교 분석**: 배치별 성능 비교 및 패턴 분석 가능
- **마크다운 보고서**: 읽기 쉬운 형식의 보고서로 공유 및 문서화 용이

## 배치 스크립트 사용

편의를 위해 제공되는 배치 스크립트를 사용할 수 있습니다:

```bash
# Windows 배치 스크립트 실행
run_multi_batch_cli.bat
```

이 스크립트는 기본 설정으로 계정 1, 2, 3을 실행하며, 사용법 안내도 함께 제공합니다.

## 주의사항

1. **계정 형식**: 숫자로 입력하면 자동으로 `account_` 접두사가 추가됩니다.
2. **실행 간격**: 배치 간 간격을 너무 짧게 설정하면 시스템 부하가 발생할 수 있습니다.
3. **동시 실행**: 다중 배치는 순차 실행되므로, 각 배치는 개별적으로 처리됩니다.
4. **로그 용량**: 대량의 배치 실행 시 로그 파일 용량을 주의깊게 모니터링하세요.

## 문제 해결

### 일반적인 문제

1. **명령어 인식 오류**
   ```bash
   # 올바른 형식 확인
   python cli/batch_cli.py multi-batch --help
   ```

2. **계정 형식 오류**
   ```bash
   # 숫자 또는 account_ 형식 모두 지원
   python cli/batch_cli.py multi-batch 1 2 3        # OK
   python cli/batch_cli.py multi-batch account_1 account_2  # OK
   ```

3. **권한 문제**
   - 로그 디렉토리에 대한 쓰기 권한 확인
   - 필요시 관리자 권한으로 실행

### 로그 확인

문제 발생 시 다음 로그 파일들을 확인하세요:
- 통합 로그: `logs/unified/[세션ID].log`
- 오류 로그: `logs/errors/[세션ID]_errors.log`
- 계정별 로그: `logs/accounts/[세션ID]/account_X.log`

---

이 가이드를 통해 다중 배치 CLI 기능을 효과적으로 활용하여 배치 작업의 효율성을 크게 향상시킬 수 있습니다.