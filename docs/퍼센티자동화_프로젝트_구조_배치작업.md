# 퍼센티 자동화 프로젝트 구조 및 배치 작업 가이드

## 1. 프로젝트 개요

퍼센티 자동화 프로젝트는 퍼센티 쇼핑몰 플랫폼에서 상품 편집, 메모 수정, 그룹 이동 등의 반복적인 작업을 자동화하는 Python 기반 솔루션입니다. Selenium 웹드라이버를 사용하여 브라우저를 제어하고, 다양한 UI 요소와 상호작용하여 작업을 자동화합니다.

### 핵심 기능
- 계정 로그인 자동화
- 상품 수정 작업 자동화
- 메모 수정 및 상세 페이지 HTML 삽입
- 상품명 수정 자동화
- 상품 그룹 이동 자동화
- 안정적인 DOM 선택자 기반 UI 상호작용

## 2. 프로젝트 구조

프로젝트는 여러 Python 모듈로 구성되어 있으며, 각 모듈은 특정 기능을 담당합니다.

```
percenty_project/
│
├── batch_run.py                 # 메인 실행 파일
├── batch_processor.py           # 배치 처리 핵심 로직
├── ui_elements.py               # UI 요소 정의 및 선택자 관리
├── dropdown_utils.py            # 드롭다운 메뉴 관련 유틸리티
├── product_editor_core.py       # 상품 편집 핵심 기능
├── click_utils.py               # 클릭 관련 유틸리티 함수
├── login_percenty.py            # 로그인 관련 기능
├── modal_blocker.py             # 모달창 처리 유틸리티
├── coordinates_login.py         # 좌표 기반 로그인 기능
├── coordinates_action.py        # 좌표 기반 액션 기능
├── menu_clicks.py               # 메뉴 클릭 관련 기능
├── keyboard_shortcuts.py        # 키보드 단축키 유틸리티
├── image_utils.py               # 이미지 처리 유틸리티
├── product_name_editor.py       # 상품명 편집 유틸리티
└── percenty_utils.py            # 일반 유틸리티 함수
```

## 3. 핵심 모듈 설명

### batch_run.py
- 프로그램의 진입점(엔트리 포인트)
- 사용자 인터페이스 제공
- 계정 선택 및 작업 수량 설정
- 배치 프로세서 초기화 및 실행

### batch_processor.py
- 배치 작업의 핵심 로직 구현
- 브라우저 초기화 및 설정
- 로그인 처리
- 메뉴 탐색 및 상품 목록 접근
- 상품 처리 작업 조정
- 결과 로깅 및 예외 처리

### ui_elements.py
- UI 요소의 선택자 정의
- XPath, CSS 선택자, 좌표 등 저장
- 중앙 집중식 UI 요소 관리

### dropdown_utils.py
- 드롭다운 메뉴 관련 기능 구현
- `PercentyDropdown` 클래스 및 `get_dropdown_manager()` 함수 제공
- 상품 그룹 선택 및 이동 기능

### product_editor_core.py
- 상품 편집의 핵심 기능 구현
- 메모 수정, HTML 삽입, 상품명 변경 등 기능
- 상품 선택 및 모달창 제어
- 그룹 이동 처리

### click_utils.py
- 클릭 관련 유틸리티 함수
- DOM 선택자 및 좌표 기반 클릭 지원
- 하이브리드 방식의 클릭 메커니즘 구현
- 클릭 실패 시 대체 메커니즘 제공

### login_percenty.py
- 퍼센티 로그인 프로세스 구현
- 계정 정보 처리
- 로그인 폼 제출 및 검증

### modal_blocker.py
- 모달창 감지 및 처리
- 모달창 닫기 기능
- 쿠키 및 localStorage 설정을 통한 모달창 억제

### menu_clicks.py
- 메뉴 탐색 및 클릭 기능
- AI 소싱, 그룹 상품관리 등 메뉴 접근
- DOM 선택자 기반 메뉴 클릭 구현

### keyboard_shortcuts.py
- 키보드 단축키 시뮬레이션
- 복사/붙여넣기, 전체 선택 등 기능
- 키 입력 자동화

### image_utils.py
- 이미지 관련 기능 구현
- 상세 페이지 이미지 관리
- 이미지 삭제 기능

### product_name_editor.py
- 상품명 편집 기능 구현
- 상품명 추출 및 수정
- 접미사 추가 등 기능

## 4. 배치 작업 흐름

배치 작업은 다음과 같은 순서로 진행됩니다:

1. **초기화**
   - 브라우저 설정
   - 계정 로그인
   - 모달창 처리

2. **메뉴 탐색**
   - AI 소싱 메뉴 클릭
   - 그룹 상품관리 메뉴 클릭
   - 비그룹상품보기 토글 클릭

3. **상품별 처리 과정**
   - 첫 번째 상품 클릭
   - 메모 편집 (원본 메모 + '-S' 접미사 추가)
   - 상세페이지 탭에서 HTML 삽입 (원본 메모 삽입)
   - 이미지 개수 확인 및 31개 이상 시 삭제
   - 업로드 탭에서 상품정보고시 내용 입력
   - 상품명 탭에서 상품명 수정 (접미사 'A' 추가)
   - 모달창 닫기
   - 신규수집 그룹으로 이동

4. **완료 및 정리**
   - 결과 로깅
   - 브라우저 종료

## 5. 실행 방법

### 필수 요구사항
- Python 3.7 이상
- Selenium 웹드라이버
- Chrome 브라우저
- 필요한 Python 패키지 설치 (`selenium`, `pandas` 등)

### 실행 단계

1. 명령 프롬프트를 열고 프로젝트 디렉토리로 이동합니다:
   ```
   cd c:\Projects\percenty_project
   ```

2. 배치 실행 스크립트를 실행합니다:
   ```
   python batch_run.py
   ```

3. 프로그램의 안내에 따라 계정을 선택합니다:
   ```
   사용할 계정 번호를 입력하세요 (종료하려면 'q' 입력): 1
   ```

4. 작업할 상품 수량을 입력합니다:
   ```
   수량 입력 또는 선택: 3
   ```

5. 자동화 프로세스가 시작되고 진행 상황이 표시됩니다:
   ```
   작업 시작!
   진행 상황: 1/3 (성공: 1, 실패: 0)
   ...
   ```

## 6. 주요 개선사항 및 주의사항

### 최근 개선사항
- DOM 선택자 기반 클릭 방식 우선 적용 (좌표 기반은 폴백으로 사용)
- 드롭다운 관리자 시스템 개선 (`get_dropdown_manager()` 함수 사용)
- 그룹 이동 메커니즘 안정화
- 메뉴 클릭 안정성 향상

### 주의사항
- **화면 해상도**: 프로그램은 전체화면 모드(1920x1080 이상)에서 가장 잘 작동합니다.
- **브라우저 간섭**: 자동화 과정 중에는 브라우저를 수동으로 조작하지 마십시오.
- **인터넷 연결**: 안정적인 인터넷 연결이 필요합니다.
- **계정 정보**: 올바른 계정 정보가 구성되어 있는지 확인하십시오.
- **크롬 버전**: 최신 Chrome 브라우저와 호환되는 ChromeDriver 버전을 사용하십시오.
- **작업 중단**: 작업 중 중단이 필요할 경우 `Ctrl+C`를 누르면 안전하게 종료됩니다.

### 문제 해결
- **클릭 오류**: UI 변경으로 인한 클릭 실패 시 `ui_elements.py`의 선택자를 업데이트하세요.
- **로그인 실패**: 계정 정보가 올바른지 확인하고 필요시 캡챠 문제를 수동으로 해결하세요.
- **드롭다운 오류**: 그룹 선택이 작동하지 않을 경우 `dropdown_utils.py`를 확인하세요.
- **비정상 종료**: 오류 로그를 확인하고 관련 모듈을 디버깅하세요.

## 7. 주요 이슈 해결 사례

### 드롭다운 매니저 문제 해결
- 문제: `'NoneType' object has no attribute 'select_product_group_by_name'` 오류 발생
- 해결: `product_editor_core.py`에서 `DropdownManager` 클래스 대신 `get_dropdown_manager()` 함수 사용하도록 수정

### 메뉴 클릭 안정성 개선
- 문제: 좌표 기반 클릭이 UI 변경 시 실패하는 문제
- 해결: DOM 선택자 기반 클릭을 우선 시도하고, 실패 시 좌표 기반 클릭을 폴백으로 사용하는 하이브리드 방식 구현

### 모달창 처리 개선
- 문제: 간헐적으로 모달창이 작업을 방해하는 문제
- 해결: 쿠키 및 localStorage 설정을 통한 모달창 억제 메커니즘 강화

---

이 문서는 퍼센티 자동화 프로젝트의 구조와 배치 작업에 대한 개요를 제공합니다. 더 자세한 정보는 각 모듈의 코드 주석을 참조하거나 개발자에게 문의하십시오.

마지막 업데이트: 2025-05-27
