# 이미지 번역 자동 감지 기능 가이드

## 개요

`specific:all` 액션을 사용하여 상세페이지의 모든 이미지 중에서 **중문글자가 있는 이미지만 자동으로 감지하여 번역**하는 기능입니다.

## 사용 방법

### 기본 사용법

Excel 파일의 K열(이미지번역 액션)에 다음과 같이 입력:

```
specific:all
```

### 다른 액션과 조합

```
specific:all,1,2    # 중문글자 자동 감지 + 1번, 2번 이미지 번역
first:3,specific:all # 1~3번 이미지 + 중문글자 자동 감지
```

## 동작 원리

### 1단계: 이미지 수집
- 일괄편집 모달창이 열리면 모든 이미지 요소를 수집
- 화면에 표시되는 이미지만 대상으로 함
- 너무 작은 이미지(50x50 미만)는 제외

### 2단계: 중문글자 감지

#### 방법 1: 속성 기반 감지 (빠름)
- 이미지의 `alt`, `title`, `src` 속성에서 중문글자 확인
- 정규식 패턴 `[\u4e00-\u9fff]+` 사용

#### 방법 2: OCR 기반 감지 (정확함, 선택사항)
- 이미지를 스크린샷으로 캡처
- Tesseract OCR로 텍스트 추출
- 추출된 텍스트에서 중문글자 확인

### 3단계: 번역 실행
- 감지된 이미지들의 위치 번호를 기존 번역 로직에 전달
- 각 이미지별로 순차적으로 번역 실행

## OCR 기능 설정 (선택사항)

### 라이브러리 설치

```bash
pip install -r requirements_ocr.txt
```

### Tesseract OCR 엔진 설치

1. **Windows 사용자:**
   - [Tesseract 다운로드](https://github.com/UB-Mannheim/tesseract/wiki)
   - 설치 시 "Additional language data" 에서 Chinese (Simplified) 선택

2. **환경변수 설정 (필요시):**
   ```
   TESSDATA_PREFIX=C:\Program Files\Tesseract-OCR\tessdata
   ```

### OCR 없이 사용

OCR 라이브러리가 설치되지 않아도 기본 기능은 동작합니다:
- 이미지 속성(alt, title, src)에서 중문글자 감지
- 파일명에 중문글자가 있는 경우 감지

## 성능 최적화

### 빠른 감지를 위한 팁

1. **속성 기반 감지 우선 사용**
   - OCR보다 훨씬 빠름
   - 대부분의 경우 충분히 정확

2. **이미지 크기 최적화**
   - 너무 작은 이미지는 자동으로 제외
   - OCR 시 이미지 크기 자동 조정

3. **병렬 처리 없음**
   - 안정성을 위해 순차 처리
   - 각 이미지당 평균 1-3초 소요

## 로그 확인

### 주요 로그 메시지

```
[INFO] specific:all 형식 - 중문글자 이미지 자동 감지 모드
[INFO] 중문글자 자동 감지 모드 실행
[INFO] 총 5개의 이미지 발견
[INFO] 이미지 3: 중문글자 감지됨
[INFO] 중문글자 감지 완료 - 총 2개 이미지에서 중문글자 발견: [3, 5]
```

### 디버그 정보

```
[DEBUG] 이미지 1: 화면에 표시되지 않음
[DEBUG] 이미지 2: 크기가 너무 작음 (30x30)
[DEBUG] 이미지 3: OCR 중문글자 감지 시작
[DEBUG] 이미지 3: OCR 텍스트 추출 완료 (길이: 45)
```

## 예상 처리 시간

| 이미지 수 | 속성 기반 | OCR 포함 |
|-----------|-----------|----------|
| 5개       | 1-2초     | 5-10초   |
| 10개      | 2-3초     | 10-20초  |
| 20개      | 3-5초     | 20-40초  |

## 문제 해결

### 중문글자가 있는데 감지되지 않는 경우

1. **이미지 속성 확인**
   - 브라우저 개발자 도구로 이미지의 alt, title 속성 확인
   - 파일명에 중문글자가 있는지 확인

2. **OCR 설치 확인**
   ```python
   # 로그에서 확인
   [WARNING] OCR 라이브러리가 설치되지 않음 (PIL, pytesseract)
   ```

3. **이미지 크기 확인**
   - 너무 작은 이미지는 자동으로 제외됨
   - 최소 50x50 픽셀 이상 필요

### 처리 속도가 느린 경우

1. **OCR 비활성화**
   - OCR 라이브러리를 설치하지 않으면 속성 기반 감지만 사용
   - 훨씬 빠른 처리 가능

2. **구체적인 위치 지정**
   - `specific:all` 대신 `specific:1,3,5` 처럼 구체적 위치 지정
   - 감지 과정 생략으로 시간 단축

## 기존 기능과의 호환성

기존의 모든 액션 형식과 완전 호환:

- `1,2,3` (직접 위치 지정)
- `first:5` (첫 번째부터 5번째까지)
- `last:3` (마지막 3번째)
- `specific:2` (특정 2번째)
- `specific:all` (중문글자 자동 감지) ← **새로운 기능**

## 주의사항

1. **네트워크 속도**: 이미지 로딩 시간이 감지 시간에 영향
2. **브라우저 성능**: 많은 이미지가 있는 페이지에서는 처리 시간 증가
3. **OCR 정확도**: 이미지 품질에 따라 OCR 정확도 차이 발생
4. **언어 감지**: 현재는 중문(간체) 위주로 최적화됨